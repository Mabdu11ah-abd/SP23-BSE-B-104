<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cart Page</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

  <div class="container mt-4">
    <h1>Your Shopping Cart</h1>

    <!-- Cart Table -->
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Product</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="cart-items">
        <!-- Cart items will be inserted here dynamically -->
      </tbody>
    </table>
    <button id="clear-cart" class="btn btn-danger">Clear Cart</button>
  </div>

  <!-- Bootstrap JS & jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>

  <script>
    // Function to fetch cart data from the backend
    async function fetchCartData() {
      try {
        const response = await fetch('/api/cart');
        const cartItems = await response.json();
        renderCartItems(cartItems);
      } catch (error) {
        console.error('Error fetching cart data:', error);
      }
    }
    
    // Function to render the cart items in the table
    function renderCartItems(cartItems) {
      const cartItemsContainer = document.getElementById('cart-items');
      cartItemsContainer.innerHTML = ''; // Clear current content

      cartItems.forEach(item => {
        const row = document.createElement('tr');

        const productCell = document.createElement('td');
        productCell.textContent = item.name;
        row.appendChild(productCell);

        const priceCell = document.createElement('td');
        priceCell.textContent = `$${item.price}`;
        row.appendChild(priceCell);

        const quantityCell = document.createElement('td');
        quantityCell.textContent = item.quantity;
        row.appendChild(quantityCell);

        const totalCell = document.createElement('td');
        totalCell.textContent = `$${item.price * item.quantity}`;
        row.appendChild(totalCell);

        cartItemsContainer.appendChild(row);
      });
    }

    // Function to clear the cart
    async function clearCart() {
      // Clear the cart cookie and reload the page
      Cookies.remove('cart');
      window.location.reload();
    }

    // Add event listener to the Clear Cart button
    document.getElementById('clear-cart').addEventListener('click', clearCart);

    // Fetch and render the cart data when the page loads
    window.onload = fetchCartData;
  </script>

</body>
</html>
